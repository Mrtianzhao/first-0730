<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="net.dgg.cloud.dao.XdSalesmanMapper" >
    <resultMap id="BaseResultMap" type="net.dgg.cloud.entity.XdSalesman" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="employee_no" property="employeeNo" jdbcType="VARCHAR" />
        <result column="phone_number" property="phoneNumber" jdbcType="VARCHAR" />
        <result column="x_number" property="xNumber" jdbcType="VARCHAR" />
        <result column="city" property="city" jdbcType="VARCHAR" />
        <result column="big_biz_id" property="bigBizId" jdbcType="VARCHAR" />
        <result column="specialty" property="specialty" jdbcType="VARCHAR" />
        <result column="online_status" property="onlineStatus" jdbcType="INTEGER" />
        <result column="salesman_grade_id" property="salesmanGradeId" jdbcType="VARCHAR" />
        <result column="canOrder" property="canorder" jdbcType="INTEGER" />
        <result column="create_user_id" property="createUserId" jdbcType="VARCHAR" />
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
        <result column="update_user_id" property="updateUserId" jdbcType="VARCHAR" />
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
        <result column="is_del" property="isDel" jdbcType="INTEGER" />
        <result column="is_on" property="isOn" jdbcType="INTEGER" />
        <result column="canOrder_time" property="canorderTime" jdbcType="TIMESTAMP" />
        <result column="x_number_use_time" property="xNumberUseTime" jdbcType="TIMESTAMP" />
        <result column="re_sum" property="reSum" jdbcType="INTEGER" />
        <result column="operator_id" property="operatorId" jdbcType="VARCHAR" />
        <result column="operator_name" property="operatorName" jdbcType="VARCHAR" />
        <result column="operator_time" property="operatorTime" jdbcType="TIMESTAMP" />
        <result column="operator_work_no" property="operatorWorkNo" jdbcType="VARCHAR" />
        <result column="business_division" property="businessDivision" jdbcType="VARCHAR" />
    </resultMap>
    <sql id="Base_Column_List" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, name, employee_no, phone_number, x_number, city, big_biz_id, specialty, online_status,
        salesman_grade_id, canOrder, create_user_id, create_time, update_user_id, update_time,
        is_del, is_on, canOrder_time, x_number_use_time, re_sum, operator_id, operator_name,
        operator_time, operator_work_no, business_division
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List" />
        from xd_salesman
        where id = #{id,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from xd_salesman
        where id = #{id,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="net.dgg.cloud.entity.XdSalesman" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into xd_salesman (id, name, employee_no,
        phone_number, x_number, city,
        big_biz_id, specialty, online_status,
        salesman_grade_id, canOrder, create_user_id,
        create_time, update_user_id, update_time,
        is_del, is_on, canOrder_time,
        x_number_use_time, re_sum, operator_id,
        operator_name, operator_time, operator_work_no,
        business_division)
        values (#{id,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{employeeNo,jdbcType=VARCHAR},
        #{phoneNumber,jdbcType=VARCHAR}, #{xNumber,jdbcType=VARCHAR}, #{city,jdbcType=VARCHAR},
        #{bigBizId,jdbcType=VARCHAR}, #{specialty,jdbcType=VARCHAR}, #{onlineStatus,jdbcType=INTEGER},
        #{salesmanGradeId,jdbcType=VARCHAR}, #{canorder,jdbcType=INTEGER}, #{createUserId,jdbcType=VARCHAR},
        #{createTime,jdbcType=TIMESTAMP}, #{updateUserId,jdbcType=VARCHAR}, #{updateTime,jdbcType=TIMESTAMP},
        #{isDel,jdbcType=INTEGER}, #{isOn,jdbcType=INTEGER}, #{canorderTime,jdbcType=TIMESTAMP},
        #{xNumberUseTime,jdbcType=TIMESTAMP}, #{reSum,jdbcType=INTEGER}, #{operatorId,jdbcType=VARCHAR},
        #{operatorName,jdbcType=VARCHAR}, #{operatorTime,jdbcType=TIMESTAMP}, #{operatorWorkNo,jdbcType=VARCHAR},
        #{businessDivision,jdbcType=VARCHAR})
    </insert>
    <insert id="insertSelective" parameterType="net.dgg.cloud.entity.XdSalesman" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into xd_salesman
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="id != null" >
                id,
            </if>
            <if test="name != null" >
                name,
            </if>
            <if test="employeeNo != null" >
                employee_no,
            </if>
            <if test="phoneNumber != null" >
                phone_number,
            </if>
            <if test="xNumber != null" >
                x_number,
            </if>
            <if test="city != null" >
                city,
            </if>
            <if test="bigBizId != null" >
                big_biz_id,
            </if>
            <if test="specialty != null" >
                specialty,
            </if>
            <if test="onlineStatus != null" >
                online_status,
            </if>
            <if test="salesmanGradeId != null" >
                salesman_grade_id,
            </if>
            <if test="canorder != null" >
                canOrder,
            </if>
            <if test="createUserId != null" >
                create_user_id,
            </if>
            <if test="createTime != null" >
                create_time,
            </if>
            <if test="updateUserId != null" >
                update_user_id,
            </if>
            <if test="updateTime != null" >
                update_time,
            </if>
            <if test="isDel != null" >
                is_del,
            </if>
            <if test="isOn != null" >
                is_on,
            </if>
            <if test="canorderTime != null" >
                canOrder_time,
            </if>
            <if test="xNumberUseTime != null" >
                x_number_use_time,
            </if>
            <if test="reSum != null" >
                re_sum,
            </if>
            <if test="operatorId != null" >
                operator_id,
            </if>
            <if test="operatorName != null" >
                operator_name,
            </if>
            <if test="operatorTime != null" >
                operator_time,
            </if>
            <if test="operatorWorkNo != null" >
                operator_work_no,
            </if>
            <if test="businessDivision != null" >
                business_division,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="id != null" >
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="name != null" >
                #{name,jdbcType=VARCHAR},
            </if>
            <if test="employeeNo != null" >
                #{employeeNo,jdbcType=VARCHAR},
            </if>
            <if test="phoneNumber != null" >
                #{phoneNumber,jdbcType=VARCHAR},
            </if>
            <if test="xNumber != null" >
                #{xNumber,jdbcType=VARCHAR},
            </if>
            <if test="city != null" >
                #{city,jdbcType=VARCHAR},
            </if>
            <if test="bigBizId != null" >
                #{bigBizId,jdbcType=VARCHAR},
            </if>
            <if test="specialty != null" >
                #{specialty,jdbcType=VARCHAR},
            </if>
            <if test="onlineStatus != null" >
                #{onlineStatus,jdbcType=INTEGER},
            </if>
            <if test="salesmanGradeId != null" >
                #{salesmanGradeId,jdbcType=VARCHAR},
            </if>
            <if test="canorder != null" >
                #{canorder,jdbcType=INTEGER},
            </if>
            <if test="createUserId != null" >
                #{createUserId,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null" >
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateUserId != null" >
                #{updateUserId,jdbcType=VARCHAR},
            </if>
            <if test="updateTime != null" >
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isDel != null" >
                #{isDel,jdbcType=INTEGER},
            </if>
            <if test="isOn != null" >
                #{isOn,jdbcType=INTEGER},
            </if>
            <if test="canorderTime != null" >
                #{canorderTime,jdbcType=TIMESTAMP},
            </if>
            <if test="xNumberUseTime != null" >
                #{xNumberUseTime,jdbcType=TIMESTAMP},
            </if>
            <if test="reSum != null" >
                #{reSum,jdbcType=INTEGER},
            </if>
            <if test="operatorId != null" >
                #{operatorId,jdbcType=VARCHAR},
            </if>
            <if test="operatorName != null" >
                #{operatorName,jdbcType=VARCHAR},
            </if>
            <if test="operatorTime != null" >
                #{operatorTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operatorWorkNo != null" >
                #{operatorWorkNo,jdbcType=VARCHAR},
            </if>
            <if test="businessDivision != null" >
                #{businessDivision,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="net.dgg.cloud.entity.XdSalesman" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update xd_salesman
        <set >
            <if test="name != null" >
                name = #{name,jdbcType=VARCHAR},
            </if>
            <if test="employeeNo != null" >
                employee_no = #{employeeNo,jdbcType=VARCHAR},
            </if>
            <if test="phoneNumber != null" >
                phone_number = #{phoneNumber,jdbcType=VARCHAR},
            </if>
            <if test="xNumber != null" >
                x_number = #{xNumber,jdbcType=VARCHAR},
            </if>
            <if test="city != null" >
                city = #{city,jdbcType=VARCHAR},
            </if>
            <if test="bigBizId != null" >
                big_biz_id = #{bigBizId,jdbcType=VARCHAR},
            </if>
            <if test="specialty != null" >
                specialty = #{specialty,jdbcType=VARCHAR},
            </if>
            <if test="onlineStatus != null" >
                online_status = #{onlineStatus,jdbcType=INTEGER},
            </if>
            <if test="salesmanGradeId != null" >
                salesman_grade_id = #{salesmanGradeId,jdbcType=VARCHAR},
            </if>
            <if test="canorder != null" >
                canOrder = #{canorder,jdbcType=INTEGER},
            </if>
            <if test="createUserId != null" >
                create_user_id = #{createUserId,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null" >
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateUserId != null" >
                update_user_id = #{updateUserId,jdbcType=VARCHAR},
            </if>
            <if test="updateTime != null" >
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isDel != null" >
                is_del = #{isDel,jdbcType=INTEGER},
            </if>
            <if test="isOn != null" >
                is_on = #{isOn,jdbcType=INTEGER},
            </if>
            <if test="canorderTime != null" >
                canOrder_time = #{canorderTime,jdbcType=TIMESTAMP},
            </if>
            <if test="xNumberUseTime != null" >
                x_number_use_time = #{xNumberUseTime,jdbcType=TIMESTAMP},
            </if>
            <if test="reSum != null" >
                re_sum = #{reSum,jdbcType=INTEGER},
            </if>
            <if test="operatorId != null" >
                operator_id = #{operatorId,jdbcType=VARCHAR},
            </if>
            <if test="operatorName != null" >
                operator_name = #{operatorName,jdbcType=VARCHAR},
            </if>
            <if test="operatorTime != null" >
                operator_time = #{operatorTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operatorWorkNo != null" >
                operator_work_no = #{operatorWorkNo,jdbcType=VARCHAR},
            </if>
            <if test="businessDivision != null" >
                business_division = #{businessDivision,jdbcType=VARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="net.dgg.cloud.entity.XdSalesman" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update xd_salesman
        set name = #{name,jdbcType=VARCHAR},
        employee_no = #{employeeNo,jdbcType=VARCHAR},
        phone_number = #{phoneNumber,jdbcType=VARCHAR},
        x_number = #{xNumber,jdbcType=VARCHAR},
        city = #{city,jdbcType=VARCHAR},
        big_biz_id = #{bigBizId,jdbcType=VARCHAR},
        specialty = #{specialty,jdbcType=VARCHAR},
        online_status = #{onlineStatus,jdbcType=INTEGER},
        salesman_grade_id = #{salesmanGradeId,jdbcType=VARCHAR},
        canOrder = #{canorder,jdbcType=INTEGER},
        create_user_id = #{createUserId,jdbcType=VARCHAR},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        update_user_id = #{updateUserId,jdbcType=VARCHAR},
        update_time = #{updateTime,jdbcType=TIMESTAMP},
        is_del = #{isDel,jdbcType=INTEGER},
        is_on = #{isOn,jdbcType=INTEGER},
        canOrder_time = #{canorderTime,jdbcType=TIMESTAMP},
        x_number_use_time = #{xNumberUseTime,jdbcType=TIMESTAMP},
        re_sum = #{reSum,jdbcType=INTEGER},
        operator_id = #{operatorId,jdbcType=VARCHAR},
        operator_name = #{operatorName,jdbcType=VARCHAR},
        operator_time = #{operatorTime,jdbcType=TIMESTAMP},
        operator_work_no = #{operatorWorkNo,jdbcType=VARCHAR},
        business_division = #{businessDivision,jdbcType=VARCHAR}
        where id = #{id,jdbcType=VARCHAR}
    </update>

  <!-- 通过手机号获取商务信息 -->
  <select id="selectSalesmanByPhone" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select
    <include refid="Base_Column_List" />
    from xd_salesman
    where phone_number = #{phone,jdbcType=VARCHAR}
  </select>


    <!--商务接单信息-->
    <select id="getAcceptInfo" parameterType="map" resultType="map">
        select c.id,c.phoneNumber,c.`name`,c.storageNum,c.monthOrderNum,c.businessName,d.useNum,e.acceptNum from
        (select b.id id, b.phoneNumber phoneNumber,b.name name, xdsg.storage_num storageNum, xdsg.month_order_num monthOrderNum, xdb.business_name businessName from
        (select xds.id id, xds.phone_number phoneNumber, xds.name, xds.specialty specialty, xds.salesman_grade_id salesman_grade_id  from xd_salesman xds
        where xds.id = #{commerceId}

         and xds.is_del = 0  and xds.is_on = 0) b
        left join xd_salesman_grade xdsg on b.salesman_grade_id = xdsg.id left join xd_business xdb on b.specialty = xdb.id) c left join
        (select count(1) useNum,a.commerce_id commerceId from
        (select xdb.commerce_id commerce_id  from  xd_resources_base xdb where (xdb.resources_status=1 or xdb.resources_status=2 or xdb.resources_status=3 or xdb.resources_status=4)
        and xdb.commerce_id = #{commerceId}
        ) a group by a.commerce_id) d on c.id = d.commerceId left join
        (select xdor.commerce_id,count(1) acceptNum from xd_order_record xdor where xdor.commerce_id = #{commerceId}
        and DATE_FORMAT(xdor.create_time,'%Y%m')=DATE_FORMAT(#{nowTime},'%Y%m') and xdor.is_type = 1 and del_flag=0 group by xdor.commerce_id) e on c.id= e.commerce_id

    </select>
</mapper>